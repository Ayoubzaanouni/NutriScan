from flask import Flask
from flask import request
import json

app = Flask(__name__)

@app.route('/',methods=['GET','POST'])
def hello_world():
    barcode = str(request.args.get('barcode'))
    country = get_country_name(barcode)

    data_set = {'flag': country}
    json_dump = json.dumps(data_set)
    return json_dump


def get_country_name(barcode_data):
    country_code_1 = int(barcode_data[0:1])
    if country_code_1 == 0 or country_code_1 == 1:
        return "US"

    country_code_2 = int(barcode_data[0:2])
    country_2 = country_2_digit_codes.get(country_code_2, "Unknown Country")

    if country_2 == "Unknown Country":
        country_code_3 = int(barcode_data[0:3])
        country_3 = country_3_digit_codes.get(country_code_3, "Unknown Country")
        return country_3
    else:
        return country_2


country_2_digit_codes = {
            30: "FR",
            31: "FR",
            32: "FR",
            33: "FR",
            34: "FR",
            35: "FR",
            36: "FR",
            37: "FR",
            40: "DE",
            44: "GB",
            45: "JP",
            49: "JP",
            46: "RU",
            47: "TW",
            50: "GB",
            54: "BE",
            64: "FI",
            69: "CN",
            70: "NO",
            73: "SE",
            87: "AN",
            90: "AT",
            91: "AT",
            93: "AU",
            94: "NZ",
}

country_3_digit_codes = {
            383: "SI",
            385: "HR",
            387: "BA",
            389: "ME",
            390: "XK",
            470: "KG",
            471: "TW",
            474: "EE",
            380: "BG",
            475: "LV",
            476: "AZ",
            477: "LT",
            478: "UZ",
            479: "LK",
            480: "PH",
            481: "BY",
            482: "UA",
            483: "TM",
            484: "MD",
            485: "AM",
            486: "GE",
            487: "KZ",
            488: "TJ",
            489: "HK",
            520: "GR",
            521: "GR",
            528: "LB",
            529: "CY",
            530: "AL",
            531: "MK",
            535: "MT",
            539: "IE",
            560: "PT",
            569: "IS",
            570: "DK",
            590: "PL",
            594: "RO",
            599: "HU",
            600: "ZA",
            601: "ZA",
            602: "BJ",
            603: "GH",
            604: "SN",
            608: "BH",
            609: "MU",
            611: "MA",
            613: "DZ",
            616: "KE",
            618: "CI",
            619: "TN",
            620: "TZ",
            621: "SY",
            622: "EG",
            623: "BN",
            624: "LY",
            625: "JO",
            626: "IR",
            627: "KW",
            628: "SA",
            629: "AE",
            729: "IL",
            871: "IL",
            740: "GT",
            741: "SV",
            742: "HN",
            743: "NI",
            744: "CR",
            745: "PA",
            746: "DO",
            750: "MX",
            759: "VE",
            761: "CH",
            770: "CO",
            771: "CO",
            773: "UY",
            775: "PE",
            777: "BO",
            779: "AR",
            780: "CL",
            784: "PY",
            786: "EC",
            789: "BR",
            790: "BR",
            800: "IT",
            801: "IT",
            802: "IT",
            803: "IT",
            804: "IT",
            805: "IT",
            806: "IT",
            807: "IT",
            808: "IT",
            809: "IT",
            810: "IT",
            811: "IT",
            812: "IT",
            813: "IT",
            814: "IT",
            815: "IT",
            816: "IT",
            817: "IT",
            818: "IT",
            819: "IT",
            820: "IT",
            821: "IT",
            822: "IT",
            823: "IT",
            824: "IT",
            825: "IT",
            826: "IT",
            827: "IT",
            828: "IT",
            829: "IT",
            830: "IT",
            831: "IT",
            832: "IT",
            833: "IT",
            834: "IT",
            835: "IT",
            836: "IT",
            837: "IT",
            838: "IT",
            839: "IT",
            840: "ES",
            841: "ES",
            842: "ES",
            843: "ES",
            844: "ES",
            845: "ES",
            846: "ES",
            847: "ES",
            848: "ES",
            849: "ES",
            850: "CU",
            858: "SK",
            859: "CZ",
            860: "RS",
            865: "MN",
            867: "KP",
            868: "TR",
            869: "TR",
            880: "KR",
            885: "TH",
            888: "SG",
            890: "IN",
            893: "VN",
            896: "PK",
            899: "ID",
            955: "MY",
            958: "MO",
        }